# --- Save Ctrl-Key Coordinates to Downloads Folder ---
Add-Type -AssemblyName System.Windows.Forms
Add-Type -AssemblyName System.Drawing

# Get user's Downloads folder
$downloads = [Environment]::GetFolderPath('UserProfile') + "\Downloads"
$outputFile = Join-Path $downloads "MouseCoordinates.txt"

Write-Host "Monitoring for Ctrl key presses... (Press Ctrl+C to stop)"
Write-Host "Coordinates will be saved to: $outputFile"

# Add keyboard listener
Add-Type @"
using System;
using System.Runtime.InteropServices;
public class KeyboardListener {
    [DllImport("user32.dll")]
    public static extern short GetAsyncKeyState(int vKey);
}
"@

# Virtual key codes for Ctrl
$VK_LCONTROL = 0xA2
$VK_RCONTROL = 0xA3

while ($true) {
    Start-Sleep -Milliseconds 50

    if (
        ([KeyboardListener]::GetAsyncKeyState($VK_LCONTROL) -band 0x8000) -or
        ([KeyboardListener]::GetAsyncKeyState($VK_RCONTROL) -band 0x8000)
    ) {
        $pos = [System.Windows.Forms.Cursor]::Position
        $time = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
        $line = "$time : X=$($pos.X), Y=$($pos.Y)"

        Add-Content -Path $outputFile -Value $line
        Write-Host "Saved -> $line"

        Start-Sleep -Seconds 1  # debounce
    }
}
